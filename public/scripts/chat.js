'use strict';function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}new Vue({el:'#app',delimiters:['${','}'],components:{'vue-pull-refresh':VuePullRefresh},data:{ws:null,message:'',chat:[],users:[],showUsers:!1},created:function created(){var a=this,b='https:'===window.location.protocol?'wss:':'ws:';this.ws=new WebSocket(b+'//'+window.location.host+'/ws'),this.ws.addEventListener('message',function(b){var c=JSON.parse(b.data);if('bootstrap'===c.type){var d=JSON.parse(b.data),e=d.messages,f=d.users;e.forEach(function(b){var c=b.id,d=b.userId,e=b.userName,f=b.avatar,g=b.type,h=b.content,i=b.date;a.chat.push({id:c,userId:d,userName:e,avatar:f,type:g,content:h,date:new Date(i)})}),a.users=[].concat(_toConsumableArray(f))}else if('messages'===c.type){var g=JSON.parse(b.data),h=g.messages;h.forEach(function(b){var c=b.id,d=b.userId,e=b.userName,f=b.avatar,g=b.type,h=b.content,i=b.date;a.chat.some(function(a){return a.id===c})||a.chat.push({id:c,userId:d,userName:e,avatar:f,type:g,content:h,date:new Date(i)})})}else{var i=c.id,j=c.userId,k=c.userName,l=c.avatar,m=c.type,n=c.content,o=c.date;a.chat.push({id:i,userId:j,userName:k,avatar:l,type:m,content:n,date:new Date(o)}),'login'===m?!a.users.some(function(a){return a.id===j})&&a.users.push({id:j,name:k,avatar:l}):'logout'===m&&a.users.some(function(a){return a.id===j})&&a.users.splice(a.users.findIndex(function(a){return a.id===j}),1)}a.chat.sort(function(c,a){return new Date(c.date)>new Date(a.date)?1:new Date(c.date)<new Date(a.date)?-1:0})}),this.ws.addEventListener('close',function(){a.chat.push({type:'warning',content:i18n.chat_warning_connection_closed}),a.ws=null}),this.ws.addEventListener('error',function(){a.chat.push({type:'warning',content:i18n.chat_warning_connection_error}),a.ws=null})},updated:function updated(){this.scrollToLast()},directives:{scroll:{componentUpdated:function componentUpdated(a,b,c,d){var e=2===d.children.length;app.__vue__.scrollToLast(e)}}},methods:{send:function send(){this.message&&(270<this.message.length||(this.ws&&this.ws.send(JSON.stringify({type:'message',content:this.message})),this.message=''))},scrollToLast:function scrollToLast(){var a=0<arguments.length&&arguments[0]!==void 0&&arguments[0],b=this.$refs.chat,c=a||b.scrollTop>b.scrollHeight-b.clientHeight-150;c&&(b.scrollTop=b.scrollHeight-b.clientHeight)},toggleUsers:function toggleUsers(){this.showUsers=!this.showUsers},onPullRefresh:function onPullRefresh(){var a=this;return new Promise(function(b,c){a.ws?(a.ws.send(JSON.stringify({type:'request',content:'olderMessages',date:a.chat[0].date})),a.ws.addEventListener('message',function(){return b()}),a.ws.addEventListener('error',function(){return c()})):c()})},formatDate:function formatDate(a){var b=new Date(a).setHours(0,0,0,0),c=new Date().setHours(0,0,0,0),d=new Date(new Date().setDate(new Date().getDate()-1)).setHours(0,0,0,0),e=b===c?i18n.date_today:b===d?i18n.date_yesterday:a.toLocaleString().slice(0,10),f=a.toTimeString().slice(0,5);return e+' '+i18n.date_at+' '+f}}});

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NvdXJjZS9zY3JpcHRzL2NoYXQuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6InNKQUFBLEdBQUksSUFBSixDQUFRLENBQ04sR0FBSSxNQURFLENBS04scUJBTE0sQ0FPTixXQUFZLENBQ1YsbUJBQW9CLGNBRFYsQ0FQTixDQVdOLEtBQU0sQ0FDSixHQUFJLElBREEsQ0FFSixRQUFTLEVBRkwsQ0FHSixPQUhJLENBSUosUUFKSSxDQUtKLFlBTEksQ0FYQSxDQW1CTixRQUFTLGtCQUFXLFlBQ2QsRUFBeUMsUUFBN0IsVUFBTyxRQUFQLENBQWdCLFFBQWpCLENBQTBDLE1BQTFDLENBQW1ELEtBRGhELENBRWxCLEtBQUssRUFBTCxDQUFVLEdBQUksVUFBSixRQUE4QixPQUFPLFFBQVAsQ0FBZ0IsSUFBOUMsT0FGUSxDQUlsQixLQUFLLEVBQUwsQ0FBUSxnQkFBUixDQUF5QixTQUF6QixDQUFvQyxXQUFPLENBQ3pDLEdBQUksR0FBTyxLQUFLLEtBQUwsQ0FBVyxFQUFFLElBQWIsQ0FBWCxDQUdBLEdBQWtCLFdBQWQsS0FBSyxJQUFULENBQStCLE9BQ0gsS0FBSyxLQUFMLENBQVcsRUFBRSxJQUFiLENBREcsS0FDdkIsUUFEdUIsS0FDYixLQURhLENBSTdCLEVBQVMsT0FBVCxDQUFpQixXQUFhLFNBQ3RCLEVBRHNCLEtBQ2xCLE1BRGtCLEtBQ1YsUUFEVSxLQUNBLE1BREEsS0FDUSxJQURSLEtBQ2MsT0FEZCxLQUN1QixJQUR2QixDQUU1QixFQUFLLElBQUwsQ0FBVSxJQUFWLENBQWUsQ0FBRSxJQUFGLENBQU0sUUFBTixDQUFjLFVBQWQsQ0FBd0IsUUFBeEIsQ0FBZ0MsTUFBaEMsQ0FBc0MsU0FBdEMsQ0FBK0MsS0FBTSxHQUFJLEtBQUosR0FBckQsQ0FBZixDQUNELENBSEQsQ0FKNkIsQ0FVN0IsRUFBSyxLQUFMLGlDQUNELENBWEQsSUFjSyxJQUFrQixVQUFkLEtBQUssSUFBVCxDQUE4QixPQUNkLEtBQUssS0FBTCxDQUFXLEVBQUUsSUFBYixD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QVgsR0FBdUIsQ0FBMUMsQ0FEYyxFQUVkLFFBRmMsQ0FFTCxDQUZLLENBRUYsQ0FGRSxDQUVDLENBRkQsQ0FFSSxDQUZKLENBSGhCLENBT0ksRUFBTyxLQUFELENBQWdCLGVBQWhCLENBQ1AsS0FBRCxDQUFvQixtQkFBcEIsQ0FDQSxFQUFLLGNBQUwsR0FBc0IsS0FBdEIsQ0FBNEIsQ0FBNUIsQ0FBK0IsRUFBL0IsQ0FURixDQVVJLEVBQU8sRUFBSyxZQUFMLEdBQW9CLEtBQXBCLENBQTBCLENBQTFCLENBQTZCLENBQTdCLENBVlgsQ0FZQSxhQUFpQixZQUFqQixNQUNELENBNURNLENBMUhILENBQVIsQyIsImZpbGUiOiJjaGF0LmpzIiwic291cmNlc0NvbnRlbnQiOlsibmV3IFZ1ZSh7XG4gIGVsOiAnI2FwcCcsXG5cbiAgLy8gVXNpbmcgRVM2IHN0cmluZyBsaXR0ZXJhbCBkZWxpbWl0ZXJzIGJlY2F1c2VcbiAgLy8gR28gdXNlcyB7eyAuIH19IGZvciBpdHMgdGVtcGxhdGVzXG4gIGRlbGltaXRlcnM6IFsnJHsnLCAnfSddLFxuXG4gIGNvbXBvbmVudHM6IHtcbiAgICAndnVlLXB1bGwtcmVmcmVzaCc6IFZ1ZVB1bGxSZWZyZXNoXG4gIH0sXG5cbiAgZGF0YToge1xuICAgIHdzOiBudWxsLFxuICAgIG1lc3NhZ2U6ICcnLFxuICAgIGNoYXQ6IFtdLFxuICAgIHVzZXJzOiBbXSxcbiAgICBzaG93VXNlcnM6IGZhbHNlLFxuICB9LFxuXG4gIGNyZWF0ZWQ6IGZ1bmN0aW9uKCkge1xuICAgIGxldCBwcm90b2NvbCA9ICh3aW5kb3cubG9jYXRpb24ucHJvdG9jb2wgPT09ICdodHRwczonKSA/ICd3c3M6JyA6ICd3czonXG4gICAgdGhpcy53cyA9IG5ldyBXZWJTb2NrZXQoYCR7cHJvdG9jb2x9Ly8ke3dpbmRvdy5sb2NhdGlvbi5ob3N0fS93c2ApXG5cbiAgICB0aGlzLndzLmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCAoZSkgPT4ge1xuICAgICAgbGV0IGRhdGEgPSBKU09OLnBhcnNlKGUuZGF0YSlcblxuICAgICAgLy8gQm9vdHN0cmFwXG4gICAgICBpZiAoZGF0YS50eXBlID09PSBcImJvb3RzdHJhcFwiKSB7XG4gICAgICAgIGxldCB7IG1lc3NhZ2VzLCB1c2VycyB9ID0gSlNPTi5wYXJzZShlLmRhdGEpXG5cbiAgICAgICAgLy8gUmV0cmlldmUgbWVzc2FnZXNcbiAgICAgICAgbWVzc2FnZXMuZm9yRWFjaCgobWVzc2FnZSkgPT4ge1xuICAgICAgICAgIGxldCB7IGlkLCB1c2VySWQsIHVzZXJOYW1lLCBhdmF0YXIsIHR5cGUsIGNvbnRlbnQsIGRhdGUgfSA9IG1lc3NhZ2VcbiAgICAgICAgICB0aGlzLmNoYXQucHVzaCh7IGlkLCB1c2VySWQsIHVzZXJOYW1lLCBhdmF0YXIsIHR5cGUsIGNvbnRlbnQsIGRhdGU6IG5ldyBEYXRlKGRhdGUpIH0pXG4gICAgICAgIH0pXG5cbiAgICAgICAgLy8gUmV0cmlldmUgdXNlcnNcbiAgICAgICAgdGhpcy51c2VycyA9IFsuLi51c2Vyc11cbiAgICAgIH1cblxuICAgICAgLy8gQnVsayBtZXNzYWdlc1xuICAgICAgZWxzZSBpZiAoZGF0YS50eXBlID09PSBcIm1lc3NhZ2VzXCIpIHtcbiAgICAgICAgbGV0IHsgbWVzc2FnZXMgfSA9IEpTT04ucGFyc2UoZS5kYXRhKVxuXG4gICAgICAgIC8vIFJldHJpZXZlIG1lc3NhZ2VzXG4gICAgICAgIG1lc3NhZ2VzLmZvckVhY2goKG1lc3NhZ2UpID0+IHtcbiAgICAgICAgICBsZXQgeyBpZCwgdXNlcklkLCB1c2VyTmFtZSwgYXZhdGFyLCB0eXBlLCBjb250ZW50LCBkYXRlIH0gPSBtZXNzYWdlXG5cbiAgICAgICAgICAvLyBBcyBWdWVKUyB0ZW1wbGF0ZSBkaXJlY3RpdmVzIGRvbid0IGl0ZXJhdGUgb3ZlciBTZXQgb3IgTWFwXG4gICAgICAgICAgLy8gbWFrZSBzdXJlIHdlIGFyZSBub3QgYWRkaW5nIGR1cGxpY2F0ZWQuXG4gICAgICAgICAgaWYgKCF0aGlzLmNoYXQuc29tZShtZXNzYWdlID0+IG1lc3NhZ2UuaWQgPT09IGlkKSkge1xuICAgICAgICAgICAgdGhpcy5jaGF0LnB1c2goeyBpZCwgdXNlcklkLCB1c2VyTmFtZSwgYXZhdGFyLCB0eXBlLCBjb250ZW50LCBkYXRlOiBuZXcgRGF0ZShkYXRlKSB9KVxuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgIH1cblxuICAgICAgLy8gQ2hhdCBtZXNzYWdlXG4gICAgICBlbHNlIHtcbiAgICAgICAgbGV0IHsgaWQsIHVzZXJJZCwgdXNlck5hbWUsIGF2YXRhciwgdHlwZSwgY29udGVudCwgZGF0ZSB9ID0gZGF0YVxuXG4gICAgICAgIHRoaXMuY2hhdC5wdXNoKHsgaWQsIHVzZXJJZCwgdXNlck5hbWUsIGF2YXRhciwgdHlwZSwgY29udGVudCwgZGF0ZTogbmV3IERhdGUoZGF0ZSksfSlcblxuICAgICAgICAvLyBVcGRhdGUgdXNlcnMgbGlzdCBpZiBsb2dpbiBvciBsb2dvdXQgbWVzc2FnZVxuICAgICAgICBpZiAodHlwZSA9PT0gJ2xvZ2luJykge1xuICAgICAgICAgIC8vIEFzIFZ1ZUpTIHRlbXBsYXRlIGRpcmVjdGl2ZXMgZG9uJ3QgaXRlcmF0ZSBvdmVyIFNldCBvciBNYXBcbiAgICAgICAgICAvLyBtYWtlIHN1cmUgd2UgYXJlIG5vdCBhZGRpbmcgZHVwbGljYXRlZC5cbiAgICAgICAgICBpZiAoIXRoaXMudXNlcnMuc29tZSh1c2VyID0+IHVzZXIuaWQgPT09IHVzZXJJZCkpIHtcbiAgICAgICAgICAgIHRoaXMudXNlcnMucHVzaCh7IGlkOiB1c2VySWQsIG5hbWU6IHVzZXJOYW1lLCBhdmF0YXIgfSlcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ2xvZ291dCcpIHtcbiAgICAgICAgICAvLyBBcyBWdWVKUyB0ZW1wbGF0ZSBkaXJlY3RpdmVzIGRvbid0IGl0ZXJhdGUgb3ZlciBTZXQgb3IgTWFwXG4gICAgICAgICAgLy8gbWFrZSBzdXJlIHdlIGFyZSBkZWxldGluZyBhIHVzZXIgdGhhdCBleGlzdHMuXG4gICAgICAgICAgaWYgKHRoaXMudXNlcnMuc29tZSh1c2VyID0+IHVzZXIuaWQgPT09IHVzZXJJZCkpIHtcbiAgICAgICAgICAgIHRoaXMudXNlcnMuc3BsaWNlKHRoaXMudXNlcnMuZmluZEluZGV4KHVzZXIgPT4gdXNlci5pZCA9PT0gdXNlcklkKSwgMSlcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gTWFrZSBzdXJlIHRoZSBtZXNzYWdlcyBhcmUgYWx3YXlzIHNvcnRlZCBjaHJvbm9sb2dpY2FsbHkgYnkgZGF0ZVxuICAgICAgdGhpcy5jaGF0LnNvcnQoKGEsIGIpID0+IFxuICAgICAgICAobmV3IERhdGUoYS5kYXRlKSA+IG5ldyBEYXRlKGIuZGF0ZSkpID8gMSA6IFxuICAgICAgICAobmV3IERhdGUoYS5kYXRlKSA8IG5ldyBEYXRlKGIuZGF0ZSkpID8gLTEgOlxuICAgICAgICAwXG4gICAgICApXG4gICAgfSlcblxuICAgIHRoaXMud3MuYWRkRXZlbnRMaXN0ZW5lcignY2xvc2UnLCAoZSkgPT4ge1xuICAgICAgdGhpcy5jaGF0LnB1c2goe1xuICAgICAgICB0eXBlOiBcIndhcm5pbmdcIixcbiAgICAgICAgY29udGVudDogaTE4bltcImNoYXRfd2FybmluZ19jb25uZWN0aW9uX2Nsb3NlZFwiXSxcbiAgICAgIH0pXG4gICAgICB0aGlzLndzID0gbnVsbFxuICAgIH0pXG5cbiAgICB0aGlzLndzLmFkZEV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgKGUpID0+IHtcbiAgICAgIHRoaXMuY2hhdC5wdXNoKHtcbiAgICAgICAgdHlwZTogXCJ3YXJuaW5nXCIsXG4gICAgICAgIGNvbnRlbnQ6IGkxOG5bXCJjaGF0X3dhcm5pbmdfY29ubmVjdGlvbl9lcnJvclwiXSxcbiAgICAgIH0pXG4gICAgICB0aGlzLndzID0gbnVsbFxuICAgIH0pXG4gIH0sXG5cbiAgdXBkYXRlZDogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuc2Nyb2xsVG9MYXN0KClcbiAgfSxcblxuICBkaXJlY3RpdmVzOiB7XG4gICAgc2Nyb2xsOiB7XG4gICAgICBjb21wb25lbnRVcGRhdGVkOiBmdW5jdGlvbihlbCwgYmluZGluZywgdm5vZGUsIG9sZFZub2RlKSB7XG4gICAgICAgIC8vIE9ubHkgZm9yY2Ugb24gYm9vdHN0cmFwLCBhdCB3aGljaCBwb2ludCB0aGUgY2hhdCBjb250ZW50IG9ubHkgaGFzXG4gICAgICAgIC8vIDIgY2hpbGRyZW4gbm9kZXMuXG4gICAgICAgIGxldCBmb3JjZSA9IChvbGRWbm9kZS5jaGlsZHJlbi5sZW5ndGggPT09IDIpXG5cbiAgICAgICAgLy8gVGhpcyBpcyBhIGxpdHRsZSBoYWNreSBidXQgSSBoYXZlbid0IGZvdW5kIGEgYmV0dGVyIHdheSB0byBhY2Nlc3NcbiAgICAgICAgLy8gdGhlIG1ldGhvZHMgZnJvbSB0aGUgZGlyZWN0aXZlcyAuLi4gbWF5YmUgSSBzaG91bGQgcmVhZCB0aGUgZG9jc1xuICAgICAgICAvLyBhZ2FpbiDwn5iFXG4gICAgICAgIGFwcC5fX3Z1ZV9fLnNjcm9sbFRvTGFzdChmb3JjZSlcbiAgICAgIH1cbiAgICB9XG4gIH0sXG5cbiAgbWV0aG9kczoge1xuICAgIHNlbmQ6IGZ1bmN0aW9uKCkge1xuICAgICAgaWYgKCF0aGlzLm1lc3NhZ2UpIHtcbiAgICAgICAgcmV0dXJuXG4gICAgICB9IGVsc2UgaWYgKHRoaXMubWVzc2FnZS5sZW5ndGggPiAyNzApIHtcbiAgICAgICAgcmV0dXJuXG4gICAgICB9XG5cbiAgICAgIHRoaXMud3MgJiYgdGhpcy53cy5zZW5kKFxuICAgICAgICBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgdHlwZTogJ21lc3NhZ2UnLFxuICAgICAgICAgIGNvbnRlbnQ6IHRoaXMubWVzc2FnZSxcbiAgICAgICAgfSlcbiAgICAgIClcbiAgICAgIHRoaXMubWVzc2FnZSA9ICcnXG4gICAgfSxcbiAgICBzY3JvbGxUb0xhc3Q6IGZ1bmN0aW9uIChmb3JjZSA9IGZhbHNlKSB7XG4gICAgICBsZXQgJGNoYXQgPSB0aGlzLiRyZWZzLmNoYXRcbiAgICAgIGxldCBkb1Njcm9sbCA9IGZvcmNlIHx8XG4gICAgICAgICRjaGF0LnNjcm9sbFRvcCA+ICRjaGF0LnNjcm9sbEhlaWdodCAtICRjaGF0LmNsaWVudEhlaWdodCAtIDE1MFxuXG4gICAgICBpZiAoZG9TY3JvbGwpIHtcbiAgICAgICAgJGNoYXQuc2Nyb2xsVG9wID0gJGNoYXQuc2Nyb2xsSGVpZ2h0IC0gJGNoYXQuY2xpZW50SGVpZ2h0XG4gICAgICB9XG4gICAgfSxcbiAgICB0b2dnbGVVc2VyczogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLnNob3dVc2VycyA9ICF0aGlzLnNob3dVc2Vyc1xuICAgIH0sXG4gICAgb25QdWxsUmVmcmVzaDogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICBpZiAodGhpcy53cykge1xuICAgICAgICAgIHRoaXMud3Muc2VuZChcbiAgICAgICAgICAgIEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgICAgdHlwZTogJ3JlcXVlc3QnLFxuICAgICAgICAgICAgICBjb250ZW50OiAnb2xkZXJNZXNzYWdlcycsXG4gICAgICAgICAgICAgIGRhdGU6IHRoaXMuY2hhdFswXS5kYXRlXG4gICAgICAgICAgICB9KVxuICAgICAgICAgIClcbiAgICAgICAgICB0aGlzLndzLmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCAoKSA9PiByZXNvbHZlKCkpXG4gICAgICAgICAgdGhpcy53cy5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsICgpID0+IHJlamVjdCgpKVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlamVjdCgpXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfSxcbiAgICBmb3JtYXREYXRlOiBmdW5jdGlvbihkYXRlKSB7XG4gICAgICAvLyBTYXZlIHJlZmVyZW5jZSB0byBgZGF0ZWBcbiAgICAgIGxldCBkID0gbmV3IERhdGUoZGF0ZSkuc2V0SG91cnMoMCwgMCwgMCwgMClcblxuICAgICAgbGV0IHRvZGF5ID0gbmV3IERhdGUoKS5zZXRIb3VycygwLCAwLCAwLCAwKVxuICAgICAgbGV0IHllc3RlcmRheSA9IG5ldyBEYXRlKFxuICAgICAgICBuZXcgRGF0ZSgpLnNldERhdGUobmV3IERhdGUoKS5nZXREYXRlKCkgLSAxKVxuICAgICAgKS5zZXRIb3VycygwLCAwLCAwLCAwKVxuXG4gICAgICBsZXQgZGF5ID0gKGQgPT09IHRvZGF5KSA/IGkxOG5bXCJkYXRlX3RvZGF5XCJdIDpcbiAgICAgICAgKGQgPT09IHllc3RlcmRheSkgPyBpMThuW1wiZGF0ZV95ZXN0ZXJkYXlcIl0gOlxuICAgICAgICBkYXRlLnRvTG9jYWxlU3RyaW5nKCkuc2xpY2UoMCwgMTApXG4gICAgICBsZXQgdGltZSA9IGRhdGUudG9UaW1lU3RyaW5nKCkuc2xpY2UoMCwgNSlcblxuICAgICAgcmV0dXJuIGAke2RheX0gJHtpMThuW1wiZGF0ZV9hdFwiXX0gJHt0aW1lfWBcbiAgICB9XG4gIH1cbn0pXG4iXX0=